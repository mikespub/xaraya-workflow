<?xml version="1.0" encoding="utf-8"?>
<xar:template xmlns:xar="http://xaraya.com/2004/blocklayout">
<xar:if condition="empty($workflow)">
  <xar:set name="workflow">'cd_loans'</xar:set>
</xar:if>
  <div style="overflow: hidden">
    <img src="#xarTpl::getImage($workflow . '.png','workflow')#" alt="#xarML('Workflow example diagram')#" usemap="#workflow"/>
    <xar:set name="mapfile">sys::code() . 'modules/workflow/xarimages/' . xarVar::prepForOS($workflow) . '.map'</xar:set>
    <xar:if condition="file_exists($mapfile)">
      <xar:set name="map">file_get_contents($mapfile)</xar:set>
      #$map#
    <xar:else/>
      <xar:set name="process">xarMod::apiFunc('workflow', 'user', 'process')</xar:set>
      <xar:set name="map">$process->dumpProcess($workflow, '/xaraya')</xar:set>
      <pre>
        TODO: save this in file 'html/code/modules/workflow/xarimages/#$workflow#.dot' and then run the dot command:
        $ cat #$workflow#.dot | dot -Tpng -o #$workflow#.png -Tcmapx -o #$workflow#.map
        #$map#
      </pre>
    </xar:if>
  </div>
</xar:template>
